<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>for Shruti ‚Äî a small night</title>
<meta name="description" content="A small, hand-made birthday page for Shruti‚Äîdiya, blessings, her photos, greeting cards, and heart fireworks. Trust-first, playful, spiritual.">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@400;600;800&family=Caveat:wght@600&display=swap" rel="stylesheet">
<style>
/* ===== Palettes (Night / Gulabi / Denim) ===== */
:root{
  --bg1:#0c1022; --bg2:#14102e; --ink:#eef2ff; --muted:#cdd5f9; --accent:#ff8fb1; --edge:rgba(255,255,255,.12);
  --petal:#ffc8dd; --gold:#f6d06e; --card:#10182a; --card2:#0f1730;
}
.gulabi{ --bg1:#1a0b24; --bg2:#2a1345; --accent:#ff96c8; --ink:#fff4fa; --muted:#ffd9e8; --petal:#ffd1e1; --card:#1a1430; --card2:#23193f }
.denim { --bg1:#0b1322; --bg2:#0b1b33; --accent:#85a9ff; --ink:#eaf2ff; --muted:#cfe0ff; --petal:#c7d7ff; --card:#0c1629; --card2:#0e1d36 }

html,body{height:100%} html{scroll-behavior:smooth}
@media (prefers-reduced-motion:reduce){
  *{animation-duration:0.001ms!important;animation-iteration-count:1!important;transition-duration:0.001ms!important;scroll-behavior:auto!important}
}
body{
  margin:0; color:var(--ink);
  font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  background:
   radial-gradient(900px 440px at 50% -12%, rgba(155,211,255,.14), transparent 60%),
   linear-gradient(180deg,var(--bg1),var(--bg2));
  overflow-x:hidden;
}
h1,h2{font-family:"Playfair Display",serif}
.container{max-width:980px;margin:0 auto;padding:0 16px}
.section{min-height:100vh;display:grid;place-items:center;padding:84px 0;position:relative}
.center{text-align:center}
.muted{color:var(--muted)}
a.btn,button.btn{appearance:none;border:0;border-radius:16px;padding:12px 18px;font-weight:800;cursor:pointer;color:#0c0f17;
  background:linear-gradient(90deg,var(--accent),#c9a7ff);box-shadow:0 12px 24px rgba(0,0,0,.28)}
.btn:active{transform:translateY(1px) scale(.99)}
.soft{border:1px solid var(--edge);border-radius:18px;background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));box-shadow:0 18px 44px rgba(0,0,0,.35)}
.fade{opacity:0;transform:translateY(6px);animation:fade .7s ease .2s forwards}
@keyframes fade{to{opacity:1;transform:none}}
.hint{font-size:12px;color:var(--muted)}
.sig{position:fixed;left:12px;top:12px;font-size:12px;color:var(--muted);z-index:10}
.sig b{color:var(--accent)}
.mood{position:fixed;right:12px;top:12px;display:flex;gap:8px;z-index:10}
.mood button{width:26px;height:26px;border-radius:50%;border:2px solid rgba(255,255,255,.5);cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,.25)}
.mood .n{background:#1c1f2d}.mood .g{background:#ff8fb1}.mood .d{background:#85a9ff}

/* Stars + sky layers */
.stars{position:fixed;inset:0;pointer-events:none;z-index:-1;opacity:.85;
  background:
    radial-gradient(2px 2px at 18% 28%,#fff,transparent 60%),
    radial-gradient(2px 2px at 78% 22%,#fff,transparent 60%),
    radial-gradient(1.5px 1.5px at 32% 72%,#fff,transparent 60%),
    radial-gradient(1.5px 1.5px at 64% 64%,#fff,transparent 60%),
    radial-gradient(1.5px 1.5px at 52% 48%,#fff,transparent 60%);
  animation:twinkle 6s ease-in-out infinite alternate}
@keyframes twinkle{from{opacity:.6}to{opacity:1}}
#trail,#nameConstellation{position:fixed;inset:0;pointer-events:none;z-index:0;mix-blend-mode:screen;opacity:.95}

/* Petals */
#petals{position:fixed;inset:0;pointer-events:none;z-index:1}
.petal{position:fixed;top:-40px;width:14px;height:14px;background:radial-gradient(circle at 30% 30%,#fff,transparent 60%),var(--petal);
  border-radius:42% 58% 58% 42%/64% 62% 38% 36%;opacity:.75;filter:drop-shadow(0 8px 10px rgba(255,200,221,.25))}

/* Landing */
.title{font-size:clamp(24px,6vw,40px);line-height:1.28;margin:0 0 12px}
.lead{max-width:740px;margin:0 auto 16px}
.cta{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}

/* Diya */
.diya{width:140px;height:140px;position:relative;filter:drop-shadow(0 28px 40px rgba(246,208,110,.22));transform:translateY(6px) scale(.96);transition:.7s ease}
.bowl{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);width:130px;height:56px;background:radial-gradient(130px 56px at 50% 0%,#6b3b1b,#341c0f 70%);border-radius:80px 80px 30px 30px/40px 40px 30px 30px;box-shadow:inset 0 10px 24px rgba(255,255,255,.06)}
.oil{position:absolute;bottom:32px;left:50%;transform:translateX(-50%);width:110px;height:18px;background:radial-gradient(110px 18px at 50% 60%,#2c1409,#120803 70%);border-radius:999px}
.flame{position:absolute;left:50%;bottom:52px;transform:translateX(-50%) rotate(-2deg);width:20px;height:34px;background:radial-gradient(ellipse at 50% 20%,#fff6b0,#ffd275 40%,rgba(255,120,64,.9) 70%,rgba(255,120,64,0) 75%);border-radius:50%/70% 70% 30% 30%;opacity:0}
.glow{position:absolute;left:50%;bottom:52px;transform:translateX(-50%);width:110px;height:110px;border-radius:50%;background:radial-gradient(closest-side,rgba(255,214,110,.42),rgba(255,214,110,0));opacity:0}
.lit{transform:translateY(0) scale(1)}
.lit .flame{animation:flicker .18s infinite alternate .1s;opacity:1}
.lit .glow{animation:glow 1.2s ease-in-out infinite alternate .1s;opacity:1}
@keyframes flicker{from{transform:translateX(-50%) rotate(-2deg) scaleY(1)}to{transform:translateX(-50%) rotate(2deg) scaleY(1.07)}}
@keyframes glow{from{transform:translateX(-50%) scale(.9)}to{transform:translateX(-50%) scale(1.05)}}

/* Balloons + modal */
.balloon-area{position:relative;height:64vh;max-height:640px;width:100%;overflow:hidden;border-radius:18px;border:1px solid var(--edge);
  background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.02));box-shadow:inset 0 1px 0 rgba(255,255,255,.04)}
.balloon{--c:#ff9ccc;--x:10;--delay:0;position:absolute;bottom:-120px;left:calc(var(--x)*1%);width:64px;height:80px;border-radius:50% 50% 45% 45%/55% 55% 45% 45%;
  background:radial-gradient(circle at 30% 30%,#fff8,transparent 60%),var(--c);box-shadow:inset -10px -16px 24px rgba(0,0,0,.2);animation:floatUp 16s linear infinite;animation-delay:calc(var(--delay)*1s);
  display:grid;place-items:center;color:#0c0e1a;font-weight:900;text-shadow:0 1px 0 #ffffff88;cursor:pointer}
.balloon::after{content:"";position:absolute;width:2px;height:120px;background:rgba(255,255,255,.3);left:50%;bottom:-120px}
.balloon span{background:#fff;padding:4px 8px;border-radius:999px;font-size:12px}
@keyframes floatUp{from{transform:translateY(0)}to{transform:translateY(-105vh)}}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:50}
.modal.show{display:flex}
.dialog{max-width:560px;margin:16px;background:linear-gradient(180deg,#0e1628,#0c1323);border:1px solid var(--edge);border-radius:18px;padding:18px;text-align:center;box-shadow:0 18px 40px rgba(0,0,0,.44)}
.dialog h4{margin:.25rem 0 .5rem;font-size:20px}
.dialog p{margin:0;color:#c8d2f0}

/* Greeting cards section */
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px;width:min(100%,980px)}
.card{position:relative;padding:16px;border-radius:16px;background:linear-gradient(180deg,var(--card),var(--card2));border:1px solid var(--edge);box-shadow:0 16px 38px rgba(0,0,0,.35);transform:translateY(0);transition:.2s}
.card:hover{transform:translateY(-2px)}
.card h3{margin:.3rem 0 .4rem;font-family:"Caveat",cursive;font-size:24px;color:var(--accent)}
.card p{margin:.2rem 0 .2rem;line-height:1.7}
.card .charm{position:absolute;right:10px;top:10px;filter:drop-shadow(0 6px 10px rgba(0,0,0,.4))}
.card .spark{position:absolute;left:-8px;bottom:-8px;font-size:22px;opacity:.85}

/* Spotlight (her photos only) */
.gallery{display:grid;gap:12px}
.hero{position:relative;border-radius:20px;overflow:hidden;height:min(60vh,520px)}
.hero img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;transform:scale(1.06);animation:ken 14s ease-in-out infinite}
@keyframes ken{0%{transform:scale(1.04)}50%{transform:scale(1.1) translate(-1%,-1%)}100%{transform:scale(1.04)}}
.polaroids{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px}
.pol{height:160px;border-radius:12px;overflow:hidden;border:2px solid transparent;background:#fff0;cursor:grab;transform:rotate(var(--r,0deg)) scale(1);transition:transform .2s}
.pol img{width:100%;height:100%;object-fit:cover}
.pol.active{border-color:var(--accent)}
.lightbox{display:none;position:fixed;inset:0;background:rgba(0,0,0,.86);z-index:60;align-items:center;justify-content:center}
.lightbox img{max-width:92vw;max-height:86vh;border-radius:14px;border:1px solid var(--edge);box-shadow:0 22px 60px rgba(0,0,0,.6)}
.lightbox .x{position:absolute;top:12px;right:12px}

/* Inside lines mini-carousel */
.carousel{display:grid;gap:10px;justify-items:center}
.slide{max-width:760px;text-align:center;padding:16px;border-radius:16px;border:1px solid var(--edge);background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03))}
.nav{display:flex;gap:10px;justify-content:center}

/* Divine + Final */
#fire{position:absolute;inset:0;pointer-events:none}
.final p{font-size:clamp(18px,3.6vw,22px);line-height:1.6}
@media (max-width:560px){ .polaroids{grid-template-columns:repeat(2,1fr)} }
</style>
</head>

<!-- 1) Landing -->
<section class="section" id="home">
  <div class="container center">
    <h1 class="title fade">On this small night, the universe plays its sweetest tune‚Ä¶</h1>
    <p class="lead muted fade">‚Ä¶because it‚Äôs your day, <span id="nm1">Shruti</span>. (Madamji, Laadliji‚Äîhaan, dono tum ho.)</p>
    <div class="cta">
      <a class="btn" href="#spark" id="walk">Walk with me ‚Üí</a>
      <button class="btn" id="playSongTop">Play that feeling üéµ</button>
    </div>
    <p class="hint" style="margin-top:8px">Tip: add <code>?yt=VIDEO_ID</code> to the URL to preload the song.</p>
  </div>
</section>

<!-- 2) Spark (diya) -->
<section class="section" id="spark">
  <div class="container center">
    <div class="diya soft" id="diya" title="Long-press for a note">
      <div class="bowl"></div><div class="oil"></div><div class="flame"></div><div class="glow"></div>
    </div>
    <p id="line" class="muted" style="max-width:760px;margin:16px auto 6px">
      Jahan tum dheere ho, main aur dheere. Tum chup raho, main pehle sununga.
    </p>
    <a class="btn" href="#blessings">Next ‚Üí</a>
  </div>
</section>

<!-- 3) Blessings (Haryanvi sprinkles) -->
<section class="section" id="blessings">
  <div class="container center" style="width:min(100%,960px)">
    <h2 style="margin:0 0 12px;color:var(--accent)">Chhoti-chhoti aashirwad</h2>
    <div class="bArea" id="bArea" aria-label="Blessing balloons"></div>
    <p class="hint">Tap a balloon to pop it‚ÄîLaadliji, ye sab tumhare liye.</p>
    <a class="btn" href="#cards">Next ‚Üí</a>
  </div>
  <div class="modal" id="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="dialog">
      <h4 id="modalTitle">A message</h4>
      <p id="modalMsg">You are loved.</p>
      <button class="btn" id="modalClose">Close</button>
    </div>
  </div>
</section>

<!-- 4) Greeting cards row (flip to read) -->
<section class="section" id="cards">
  <div class="container">
    <h2 class="center" style="margin:0 0 12px">Some blessings, like little greeting cards</h2>
    <div class="cards" id="cardsRow">
      <!-- cards injected by JS -->
    </div>
    <div class="center" style="margin-top:12px">
      <a class="btn" href="#her">Next ‚Üí</a>
    </div>
  </div>
</section>
<!-- 5) Spotlight (only her photos) -->
<section class="section" id="her">
  <div class="container">
    <div class="gallery">
      <div class="hero soft"><img id="hero" alt="her photo" src=""></div>
      <div id="thumbs" class="thumbs"></div>
      <p class="hint center">Every picture repeats the truth: you‚Äôre sukoon‚Ä¶ the rare kind, <span id="nm2">Shruti</span>.</p>
      <div class="center" style="margin-top:10px">
        <a class="btn" href="#final">Final page ‚Üí</a>
      </div>
    </div>
  </div>
</section>

<!-- 6) Final promise + diyas heart + heart fireworks -->
<section class="section final" id="final" style="overflow:hidden">
  <canvas id="fire" aria-hidden="true"></canvas>
  <div class="container center">
    <h2 style="margin:0 0 8px">Happy Birthday, <span id="nm3">Shruti</span>!</h2>
    <p>You are not a day in my life‚Äîyou‚Äôre why my days feel alive. Madamji, I‚Äôll choose steadiness, daily.</p>
    <div class="cta">
      <button class="btn" id="gift">cute shower üéÅ</button>
      <button class="btn" id="playSongBottom">Play song again üéµ</button>
      <button class="btn" id="saveCard">Save this as PNG üíæ</button>
    </div>
  </div>
</section>

<!-- lightbox -->
<div class="lightbox" id="lb">
  <img id="lbImg" alt="">
  <button class="btn x" onclick="closeLB()">Close ‚úñ</button>
</div>

<!-- YouTube overlay -->
<div id="ytOverlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:80;align-items:center;justify-content:center">
  <div style="width:min(860px,92vw);aspect-ratio:16/9;background:#000;border:1px solid var(--edge);border-radius:12px;overflow:hidden;position:relative">
    <iframe id="yt" width="100%" height="100%" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
    <button class="btn" style="position:absolute;right:10px;top:10px" onclick="closeYT()">Close ‚úñ</button>
  </div>
</div>

<script>
/* ===== helpers ===== */
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
const QS=new URLSearchParams(location.search);

/* ===== personalization ===== */
const HER_NAME = QS.get('name') || 'Shruti';
$('#nm1').textContent = HER_NAME; $('#nm2').textContent = HER_NAME; $('#nm3').textContent = HER_NAME;

/* ===== mood toggle + memory ===== */
function setMood(m){
  localStorage.setItem('mood', m);
  document.body.classList.remove('gulabi','denim');
  if(m==='gulabi') document.body.classList.add('gulabi');
  if(m==='denim')  document.body.classList.add('denim');
}
setMood(localStorage.getItem('mood') || 'night');

/* ===== petals ===== */
(function petals(){ const wrap=$('#petals'); for(let i=0;i<22;i++){const p=document.createElement('div'); p.className='petal';
  p.style.left=(Math.random()*100)+'vw'; const dur=9000+Math.random()*7000, delay=Math.random()*4000, drift=(Math.random()<.5?-1:1)*(10+Math.random()*14);
  p.animate([{transform:'translate(0,0) rotate(0deg)',top:'-40px'},{transform:`translate(${drift}vw,110vh) rotate(${Math.random()*360}deg)`,top:'110vh'}],
            {duration:dur,delay,iterations:Infinity,easing:'ease-in'}); wrap.appendChild(p);} })();

/* ===== constellation: full-name moment (on first walk tap) ===== */
(function constellation(){
  const cvs=$('#constellation'), ctx=cvs.getContext('2d'); function fit(){cvs.width=innerWidth;cvs.height=innerHeight} fit(); addEventListener('resize',fit);
  let pts=[]; function ensure(n){ if(pts.length<n){ for(let i=pts.length;i<n;i++) pts.push({x:Math.random()*cvs.width,y:Math.random()*cvs.height*0.8+cvs.height*0.1,tx:0,ty:0}) } }
  function lines(name){ const t=(name||'You').trim().replace(/\s+/g,' '); if(t.length<=14) return [t]; const mid=Math.floor(t.length/2); let s=t.lastIndexOf(' ',mid); if(s<6||t.length-s<6) s=t.indexOf(' ',mid); return s>0?[t.slice(0,s),t.slice(s+1)]:[t]; }
  function targets(lines,density=22){ const off=document.createElement('canvas'), o=off.getContext('2d'); off.width=cvs.width; off.height=cvs.height;
    const fam='Poppins,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial'; let fs=Math.min(200,Math.max(70,off.width*0.16)); const maxW=off.width*.84;
    function w(t){o.font=`800 ${fs}px ${fam}`;return o.measureText(t).width} while(Math.max(...lines.map(w))>maxW && fs>36) fs-=2;
    o.textAlign='center';o.textBaseline='middle';o.fillStyle='#fff';const midY=off.height*.42,gap=fs*1.2;o.font=`800 ${fs}px ${fam}`;
    lines.forEach((t,i)=>o.fillText(t,off.width/2,midY+(i-(lines.length-1)/2)*gap));
    const data=o.getImageData(0,0,off.width,off.height).data, arr=[], step=Math.max(1,Math.floor(fs/density));
    for(let y=0;y<off.height;y+=step) for(let x=0;x<off.width;x+=step) if(data[(y*off.width+x)*4+3]>128) arr.push({x,y});
    return arr;
  }
  function moveTo(name,hold=3600){ const cloud=targets(lines(name)); const N=Math.min(520,Math.max(200,Math.floor(cloud.length*.55)));
    ensure(N); const sel=[]; for(let i=0;i<N;i++) sel.push(cloud[Math.floor(i*(cloud.length/N))]||{x:Math.random()*cvs.width,y:Math.random()*cvs.height});
    pts.forEach((p,i)=>{p.tx=sel[i].x;p.ty=sel[i].y}); let phase='in', t0=performance.now();
    function frame(t){ ctx.clearRect(0,0,cvs.width,cvs.height); for(const p of pts){ p.x+=(p.tx-p.x)*0.08; p.y+=(p.ty-p.y)*0.08; ctx.fillStyle='rgba(255,210,230,.95)'; ctx.fillRect(p.x,p.y,2,2) }
      if(phase==='in' && t-t0>hold){ phase='out'; pts.forEach(p=>{p.tx=Math.random()*cvs.width;p.ty=Math.random()*cvs.height*.8+cvs.height*.1}) }
      if(phase==='out'){ if(!pts.some(p=>Math.hypot(p.tx-p.x,p.ty-p.y)>0.6)) return; } requestAnimationFrame(frame) }
    requestAnimationFrame(frame);
  }
  $('#walk').addEventListener('click', ()=> moveTo(HER_NAME), { once:true });
})();

/* ===== diya trigger + type line + long-press note ===== */
const sparkIO=new IntersectionObserver(es=>{ es.forEach(e=>{ if(e.isIntersecting){ $('#diya').classList.add('lit'); typeLine(); } }); },{threshold:.4});
sparkIO.observe($('#spark'));
function typeLine(){ const el=$('#line'); const t=el.textContent.trim(); el.textContent=''; let i=0; const id=setInterval(()=>{ el.textContent+=t.charAt(i++); if(i>=t.length) clearInterval(id); },26); }
(function longPress(){ let t; const d=$('#diya'); d.addEventListener('pointerdown',()=>{ t=setTimeout(()=>alert('Panditayan,\nMain baat se pehle sunna seekh raha hoon.\nRoz thoda behtar.'),700); }); ['pointerup','pointerleave'].forEach(ev=>d.addEventListener(ev,()=>clearTimeout(t))); })();

/* ===== blessings balloons ===== */
const blessings = [
  {word:'Sukoon', color:'#ff9ccc', msg:'Laadliji, tu tension na le ‚Äî main yahin hoon.'},
  {word:'Himmat', color:'#9bd3ff', msg:'Thak gaye ho? Mere kandhe pe rakh de.'},
  {word:'Vishwas', color:'#c9a7ff', msg:'Main impress nahi ‚Äî assure karna chahta hoon.'},
  {word:'Prem', color:'#7ee6c9', msg:'Pyar shor nahi hota. Roz ka halka sa garam chai jaisa.'},
  {word:'Hasi', color:'#ffd6a5', msg:'Muskurahat mehnat lage? Aaj meri mehnat double.'},
  {word:'Barkat', color:'#bde0fe', msg:'Ramji ki kripa bani rahe.'},
];
let balloonsMade=false;
function spawnBalloons(){
  if(balloonsMade) return; balloonsMade=true;
  const area=$('#bArea');
  blessings.forEach((b,i)=>{
    const d=document.createElement('button'); d.className='balloon';
    d.style.setProperty('--c',b.color); d.style.setProperty('--x',10+i*14+(Math.random()*8)); d.style.setProperty('--delay',Math.random()*6);
    d.innerHTML=`<span>${b.word}</span>`;
    d.addEventListener('click',()=>{ popSound(); d.animate([{transform:'scale(1)'},{transform:'scale(1.2)'},{transform:'scale(0)'}],{duration:260,easing:'ease-in'}); setTimeout(()=>d.remove(),240); showModal(b.word,b.msg); });
    area.appendChild(d);
  });
}
const blessIO=new IntersectionObserver(es=>{ es.forEach(e=>{ if(e.isIntersecting) spawnBalloons(); }); },{threshold:.4});
blessIO.observe($('#blessings'));
function showModal(title,msg){ $('#modalTitle').textContent=title; $('#modalMsg').textContent=msg; $('#modal').classList.add('show'); navigator.vibrate?.(10); }
$('#modal').addEventListener('click',(e)=>{ if(e.target.id==='modal'||e.target.id==='modalClose') $('#modal').classList.remove('show'); });

/* ===== greeting cards (flip) ===== */
const CARD_DATA = [
  { title:'Subah ka vardaan', front:'Peacock-feather kind of calm.', back:'May Kanha keep mischief in your smile and peace in your steps.' },
  { title:'Himmat ka diya',   front:'Tiny light, steady flame.',     back:'Bajrangbali cover you with courage wherever you need it most.' },
  { title:'Nazakat',           front:'Soft ‚â† small.',                 back:'May life treat you gently‚Äîand may you treat yourself gentler.' },
  { title:'Vishwas',           front:'Questions welcome.',            back:'Poochhna kuch bhi ho, poochh lena. Main bhaagunga nahi.' },
];
(function buildCards(){
  const row = $('#cardsRow');
  CARD_DATA.forEach(c=>{
    const el = document.createElement('article'); el.className = 'gCard soft';
    el.innerHTML = `
      <div class="front">
        <div class="gTitle">${c.title}</div>
        <div class="gBody">${c.front}</div>
      </div>
      <div class="back">
        <div class="gTitle">For ${HER_NAME}</div>
        <div class="gBody">${c.back}</div>
      </div>`;
    el.addEventListener('click', ()=> el.classList.toggle('flip'));
    row.appendChild(el);
  });
})();

/* ===== gallery (YOU add photos here) ===== */
const PHOTOS=[
  // Replace these with HER photos (paths or URLs)
  // {src:'images/shruti1.jpg'}, {src:'images/shruti2.jpg'}, {src:'images/shruti3.jpg'},
];
(function gallery(){
  const hero=$('#hero'), thumbs=$('#thumbs');
  if(PHOTOS.length===0){
    hero.src='https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=1600&q=80&auto=format&fit=crop';
    thumbs.innerHTML='<div class="muted" style="grid-column:1/-1;text-align:center">Add her photos in <code>PHOTOS</code> (just URLs). Only her photos appear here.</div>';
    return;
  }
  let cur=0; hero.src=PHOTOS[0].src;
  PHOTOS.forEach((p,i)=>{ const t=document.createElement('div'); t.className='thumb'+(i===0?' active':''); t.innerHTML=`<img src="${p.src}" alt="her ${i+1}">`;
    t.onclick=()=>{ cur=i; hero.src=p.src; $$('.thumb').forEach(x=>x.classList.remove('active')); t.classList.add('active') };
    t.ondblclick=()=>openLB(p.src);
    thumbs.appendChild(t);
  });
  hero.onclick=()=>openLB(PHOTOS[cur]?.src||hero.src);
})();
function openLB(src){ $('#lbImg').src=src; $('#lb').style.display='flex' }
function closeLB(){ $('#lb').style.display='none' }

/* ===== soft WebAudio bed (bansuri + bell) ===== */
let audioCtx, masterGain, audioAllowed = (localStorage.getItem('audioAllowed')==='1');
function makeAmbience(){
  if(audioCtx) return;
  audioCtx = new (window.AudioContext||window.webkitAudioContext)();
  masterGain = audioCtx.createGain(); masterGain.gain.value=0.0; masterGain.connect(audioCtx.destination);
  function flute(freq,start,dur,g=0.12){
    const o=audioCtx.createOscillator(); o.type='sine'; o.frequency.value=freq;
    const gnode=audioCtx.createGain(); gnode.gain.value=0.0001;
    const vib=audioCtx.createOscillator(); vib.type='sine'; vib.frequency.value=5; const vg=audioCtx.createGain(); vg.gain.value=2; vib.connect(vg); vg.connect(o.frequency);
    o.connect(gnode); gnode.connect(masterGain);
    gnode.gain.setValueAtTime(0.0001,start);
    gnode.gain.linearRampToValueAtTime(g,start+0.4);
    gnode.gain.linearRampToValueAtTime(g*0.42,start+0.8);
    gnode.gain.exponentialRampToValueAtTime(0.0001,start+dur);
    o.start(start); vib.start(start); o.stop(start+dur+0.05); vib.stop(start+dur+0.05);
  }
  function bell(t){ [1,2.01,2.98,4.2].forEach((m,i)=>{ const o=audioCtx.createOscillator(); o.type='sine'; o.frequency.value=660*m; const g=audioCtx.createGain(); g.gain.value=0.0001; o.connect(g); g.connect(masterGain);
    g.gain.setValueAtTime(0.0001,t); g.gain.exponentialRampToValueAtTime(0.08/(i+1),t+0.02); g.gain.exponentialRampToValueAtTime(0.0001,t+1.2+i*0.2); o.start(t); o.stop(t+1.6+i*0.2); }); }
  function phrase(t0){ [440,494,523,587,523,494,440].forEach((f,i)=>flute(f/2,t0+i*0.9,1.2)); bell(t0+2.7) }
  const start=(audioCtx.currentTime||0)+0.1; phrase(start); setInterval(()=>phrase(audioCtx.currentTime+0.1),5000);
  const fade=()=>{ audioCtx.resume&&audioCtx.resume(); masterGain.gain.cancelScheduledValues(audioCtx.currentTime); masterGain.gain.linearRampToValueAtTime(0.10,audioCtx.currentTime+1.0); };
  if(audioAllowed){ fade(); }
  $('#walk').addEventListener('click', ()=>{ audioAllowed=true; localStorage.setItem('audioAllowed','1'); fade(); }, {once:true});
}

/* tiny pop sound (synth) */
function popSound(){ try{
  if(!audioCtx) return;
  const o=audioCtx.createOscillator(), g=audioCtx.createGain(); o.type='triangle'; o.frequency.value=600; g.gain.value=0.0001; o.connect(g); g.connect(masterGain);
  const t=audioCtx.currentTime; g.gain.exponentialRampToValueAtTime(0.12,t+0.01); o.frequency.exponentialRampToValueAtTime(220,t+0.08); g.gain.exponentialRampToValueAtTime(0.0001,t+0.12); o.start(t); o.stop(t+0.14);
} catch(e){} }

/* ===== YouTube overlay ===== */
function openYT(){ const id=QS.get('yt'); if(!id){ alert('Add ?yt=VIDEO_ID in the URL'); return; }
  const fr=$('#yt'); fr.src=`https://www.youtube.com/embed/${id}?autoplay=1&rel=0&modestbranding=1&playsinline=1&loop=1&playlist=${id}`; $('#ytOverlay').style.display='flex'; }
function closeYT(){ $('#ytOverlay').style.display='none'; $('#yt').src='' }
$('#playSongTop').onclick=openYT; $('#playSongBottom').onclick=openYT;

/* ===== heart fireworks + diyas gather ===== */
let fwStarted=false;
const fwIO=new IntersectionObserver(es=>{ es.forEach(e=>{ if(e.isIntersecting && !fwStarted){ fwStarted=true; fireworks(); diyasGather(); } }); },{threshold:.45});
fwIO.observe($('#final'));
function fireworks(){
  const c=$('#fire'), a=c.getContext('2d'); function fit(){ c.width=innerWidth; c.height=Math.max(300,innerHeight*.9) } fit(); addEventListener('resize',fit);
  const ps=[]; function add(x,y,vx,vy,col){ ps.push({x,y,vx,vy,col,life:70+Math.random()*30}) }
  function hv(t){ const x=16*Math.sin(t)**3, y=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t); return {x, y:-y}; }
  function burst(x,y,col,heart=true){ const n= heart?140:90; for(let i=0;i<n;i++){ if(heart){ const t=i/n*Math.PI*2, v=hv(t), m=Math.hypot(v.x,v.y)||1, s=2.2+Math.random()*2.4; add(x,y,(v.x/m)*s,(v.y/m)*s,col); } else { const ang=Math.PI*2*i/n, s=2+Math.random()*3; add(x,y,Math.cos(ang)*s,Math.sin(ang)*s,col); } } }
  function tick(){ a.clearRect(0,0,c.width,c.height); for(let i=ps.length-1;i>=0;i--){ const p=ps[i]; p.x+=p.vx; p.y+=p.vy; p.vy+=0.03; p.life--; a.fillStyle=`rgba(${p.col},${Math.max(0,p.life/100)})`; a.fillRect(p.x,p.y,2,2); if(p.life<=0) ps.splice(i,1); } requestAnimationFrame(tick) } tick();
  function boom(){ const x=Math.random()*c.width*.9+c.width*.05, y=Math.random()*c.height*.4+c.height*.1; const cols=['255,200,221','255,168,194','201,167,255','246,208,110']; burst(x,y,cols[Math.floor(Math.random()*cols.length)],Math.random()<.7); }
  for(let i=0;i<4;i++) setTimeout(boom,i*400); const iv=setInterval(boom,1200); setTimeout(()=>clearInterval(iv),12000);
}
/* cute emoji rain */
$('#gift').addEventListener('click',()=>{ const icons=['üß∏','üç´','üíó','üíû','‚ú®','üå∏','üç¨','ü™î']; const D=5200, t0=performance.now(); navigator.vibrate?.(15);
  (function drop(){ if(performance.now()-t0>D) return; const s=document.createElement('span'); s.textContent=icons[Math.floor(Math.random()*icons.length)];
    s.style.position='fixed'; s.style.top='-40px'; s.style.left=(Math.random()*innerWidth)+'px'; s.style.fontSize='32px'; s.style.zIndex='60'; document.body.appendChild(s);
    const drift=(Math.random()*2-1)*80, time=2400+Math.random()*1800;
    s.animate([{transform:'translate(0,-40px)',opacity:.95},{transform:`translate(${drift}px, ${innerHeight+60}px)`,opacity:.1}],{duration:time,easing:'ease-in'}); setTimeout(()=>s.remove(),time+60);
    requestAnimationFrame(drop); })();
});

/* ===== diyas gather into a heart (subtle glow points) ===== */
function diyasGather(){
  const wrap = document.createElement('div'); wrap.style.position='absolute'; wrap.style.inset='0'; wrap.style.pointerEvents='none'; document.querySelector('#final').appendChild(wrap);
  const pts = []; function hv(t){ const x=16*Math.sin(t)**3, y=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t); return {x,y:-y}; }
  const n=48; for(let i=0;i<n;i++){ const d=document.createElement('div'); d.style.position='absolute'; d.style.width='10px'; d.style.height='10px'; d.style.borderRadius='50%'; d.style.background='radial-gradient(circle,#ffd86e,#ff9ccc33)'; d.style.boxShadow='0 0 18px #ffd86e88'; wrap.appendChild(d); pts.push(d); }
  function layout(){ const r=Math.min(innerWidth,innerHeight)*0.22; const cx=innerWidth/2, cy=window.scrollY + document.querySelector('#final').getBoundingClientRect().top + (document.querySelector('#final').offsetHeight*.42);
    for(let i=0;i<n;i++){ const t=i/n*Math.PI*2, v=hv(t); const x=cx + (v.x* r/18), y=cy + (v.y* r/18); const d=pts[i]; d.animate([{transform:`translate(${Math.random()*innerWidth}px,-20px)`},{transform:`translate(${x-5}px,${y-5}px)`}],{duration:1200+Math.random()*600, easing:'ease-out', fill:'forwards'}); } }
  layout(); setTimeout(()=>wrap.remove(), 6000);
}

/* ===== save final section as PNG (no external libs; uses canvas drawImage) ===== */
document.getElementById('saveCard').addEventListener('click', async ()=>{
  const node = document.querySelector('#final .container');
  const r = node.getBoundingClientRect();
  const c = document.createElement('canvas'); c.width = Math.floor(r.width*2); c.height = Math.floor(r.height*2);
  const ctx = c.getContext('2d'); ctx.scale(2,2); ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--bg2'); ctx.fillRect(0,0,r.width,r.height);
  // render simple snapshot (text only, not fireworks). Lightweight, but honest.
  ctx.fillStyle = '#ffffff';
  ctx.font = '700 28px "Playfair Display", serif';
  ctx.textAlign='center';
  ctx.fillText(`Happy Birthday, ${HER_NAME}!`, r.width/2, 48);
  ctx.font = '16px Poppins, sans-serif';
  ctx.fillStyle = 'rgba(255,255,255,0.9)';
  ctx.fillText('You are why my days feel alive. I will choose steadiness, daily.', r.width/2, 78);
  const url = c.toDataURL('image/png'); const a = document.createElement('a'); a.href = url; a.download = `for-${HER_NAME}.png`; a.click();
});

/* ===== minimal music init on first interaction ===== */
document.addEventListener('DOMContentLoaded', ()=>{ makeAmbience(); });
/* ===== theme buttons ===== */
window.setMood = setMood;
/* ===== greeting cards horizontal scroll hint ===== */
$('#cardsRow').addEventListener('wheel', e=>{ if(Math.abs(e.deltaY)>Math.abs(e.deltaX)){ e.preventDefault(); $('#cardsRow').scrollLeft += e.deltaY; } }, {passive:false});
/* ===== close lightbox on bg click ===== */
$('#lb').addEventListener('click', (e)=>{ if(e.target.id==='lb') closeLB(); });
</script>
</body>
</html>