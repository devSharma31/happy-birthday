<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Night for You ‚Äî Happy Birthday ‚ô•</title>
<meta name="description" content="A playful, personal birthday story with petals, balloons, divine blessings, a dreamy photo spotlight, themes, and heart-shaped fireworks ‚Äî crafted for Shruti.">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
<style>
/* ================== THEME ================== */
:root{
  --night1:#0a0f26; --night2:#120f2e;
  --pink:#ff9ccc; --denim:#4f6fa8; --beige:#f5e6cc; --black:#0b0b10;
  --ink:#e9ecff; --muted:#c9d2f0; --flower:#ffc8dd; --gold:#f6d06e; --accent:#9bd3ff;
}
.theme-girly{ --night1:#1a0b24; --night2:#2a1345; --accent:#ff8fb1; --ink:#fff4fa; --muted:#ffd9e8 }
.theme-pink { --accent: var(--pink) }
.theme-denim{ --accent: var(--denim) }
.theme-beige{ --accent: #c79f6c; --ink:#fff8ef; --muted:#f1e1cf }
.theme-black{ --accent: #d1d5db; --night1:#06070b; --night2:#0b0c12 }

html,body{height:100%}
html{scroll-behavior:smooth}
body{
  margin:0; color:var(--ink);
  font-family:'Poppins',ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  background:
    radial-gradient(1100px 560px at 50% -10%, rgba(138,180,255,.18), transparent 70%),
    linear-gradient(180deg, var(--night1), var(--night2));
  overflow-x:hidden;
}
h1,h2{font-family:'Playfair Display',serif}
.container{max-width:1100px;margin:0 auto;padding:0 16px}
.section{min-height:100vh; display:grid; place-items:center; position:relative; padding:84px 0}
.center{text-align:center}
.hint{font-size:12px;color:var(--muted)}
.fade-up{opacity:0; transform:translateY(10px); animation:fadeUp .7s ease .2s forwards}
@keyframes fadeUp{to{opacity:1; transform:none}}

/* Stars + constellation */
.stars{position:fixed; inset:0; pointer-events:none; z-index:-1; opacity:.9;
  background:
    radial-gradient(2px 2px at 20% 30%, #fff, transparent 60%),
    radial-gradient(2px 2px at 80% 20%, #fff, transparent 60%),
    radial-gradient(1.5px 1.5px at 30% 80%, #fff, transparent 60%),
    radial-gradient(1.5px 1.5px at 70% 70%, #fff, transparent 60%),
    radial-gradient(1.5px 1.5px at 50% 50%, #fff, transparent 60%);
  animation:twinkle 6s ease-in-out infinite alternate }
@keyframes twinkle{from{opacity:.6}to{opacity:1}}
#constellation{position:fixed; inset:0; z-index:0; pointer-events:none; opacity:.9; mix-blend-mode:screen}

/* Floating petals + hearts */
.petal, .heartFloat{
  position:fixed; top:-40px; width:16px; height:16px; pointer-events:none; z-index:0; opacity:.8;
  filter:drop-shadow(0 8px 10px rgba(255,200,221,.25));
}
.petal{
  background:radial-gradient(circle at 30% 30%, #fff, transparent 60%), var(--flower);
  border-radius:40% 60% 60% 40% / 60% 60% 40% 40%;
}
.heartFloat{
  background:none; font-size:18px; /* uses character ‚ù§Ô∏è */
}

/* Buttons + chips */
.btn{
  appearance:none;border:none;border-radius:20px;padding:14px 20px;font-weight:800;cursor:pointer;
  background:
    radial-gradient(60% 100% at 50% 0%, rgba(255,255,255,.5), transparent 60%),
    linear-gradient(90deg,var(--accent),#b794ff);
  color:#0c0e1a;box-shadow:0 14px 28px rgba(0,0,0,.25)
}
.btn:active{transform:translateY(1px) scale(.99)}
.btn-row{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}

/* Theme switcher */
.themes{position:fixed; right:12px; top:12px; display:flex; gap:8px; z-index:12}
.chip{width:26px;height:26px;border-radius:50%;border:2px solid rgba(255,255,255,.5);cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,.25)}
.chip.girly{background:#ff8fb1} .chip.pink{background:var(--pink)} .chip.denim{background:var(--denim)} .chip.beige{background:var(--beige)} .chip.black{background:var(--black)} .chip.auto{background:linear-gradient(45deg,#ff9ccc,#c9a7ff,#9bd3ff)}

/* Ribbon + progress */
.nick-ribbon{position:fixed; left:50%; top:16px; transform:translateX(-50%); z-index:11; padding:6px 12px; border-radius:999px;
  background:rgba(255,255,255,.08); color:var(--ink); border:1px solid rgba(255,255,255,.12); backdrop-filter:blur(6px); font-size:12px}
.nick-ribbon b{color:var(--accent)}
.chapters{position:fixed; bottom:12px; left:50%; transform:translateX(-50%); display:flex; gap:8px; z-index:10; background:rgba(12,14,26,.35); padding:8px 12px; border-radius:999px; border:1px solid rgba(255,255,255,.08); backdrop-filter:blur(6px)}
.dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,.28);box-shadow:inset 0 0 0 1px rgba(255,255,255,.15)}
.dot.active{background:linear-gradient(180deg,var(--accent),#c9a7ff)}

/* Welcome overlay */
.welcome{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(9,12,24,.65);backdrop-filter:blur(6px);z-index:70;padding:18px}
.welcome .card{width:min(720px,92vw);border-radius:22px;padding:22px;text-align:center;border:1px solid rgba(255,255,255,.12);background:linear-gradient(180deg,#0f1730,#0c1226);box-shadow:0 18px 44px rgba(0,0,0,.45)}
.welcome h2{margin:.2rem 0 .6rem;font-size:clamp(20px,5vw,30px)}
.welcome p{margin:.2rem 0 1rem;color:#cfe2ff}
#welcome.fade-out{animation:fadeWelcome .28s ease forwards}
@keyframes fadeWelcome{to{opacity:0;visibility:hidden}}

/* Landing */
.landing-inner{text-align:center;max-width:820px}
.title{font-size:clamp(24px,6vw,42px);line-height:1.25}

/* Diya spark */
.spark-wrap{display:grid;gap:22px;justify-items:center;text-align:center;max-width:760px}
.diya{width:150px;height:150px;position:relative;filter:drop-shadow(0 30px 40px rgba(246,208,110,.22)); transform:translateY(8px) scale(.96);transition:.7s ease}
.diya .bowl{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);width:140px;height:60px;background:radial-gradient(150px 60px at 50% 0%,#6b3b1b,#341c0f 70%);border-radius:80px 80px 30px 30px/40px 40px 30px 30px;box-shadow:inset 0 10px 26px rgba(255,255,255,.06)}
.diya .oil{position:absolute;bottom:34px;left:50%;transform:translateX(-50%);width:120px;height:20px;background:radial-gradient(120px 20px at 50% 60%,#2c1409,#120803 70%);border-radius:999px}
.flame{position:absolute;left:50%;bottom:54px;transform:translateX(-50%) rotate(-2deg);width:22px;height:36px;background:radial-gradient(ellipse at 50% 20%,#fff6b0,#ffd275 40%,rgba(255,120,64,.9) 70%,rgba(255,120,64,0) 75%); border-radius:50%/70% 70% 30% 30%;opacity:0;filter:blur(.3px)}
.glow{position:absolute;left:50%;bottom:54px;transform:translateX(-50%);width:120px;height:120px;border-radius:50%;background:radial-gradient(closest-side,rgba(255,214,110,.42),rgba(255,214,110,0));opacity:0;pointer-events:none}
.diya.lit{transform:translateY(0) scale(1)}
.diya.lit .flame{animation:flicker .18s infinite alternate .2s;opacity:1}
.diya.lit .glow{animation:glow 1.2s ease-in-out infinite alternate .2s;opacity:1}
@keyframes flicker{from{transform:translateX(-50%) rotate(-2deg) scaleY(1)}to{transform:translateX(-50%) rotate(2deg) scaleY(1.07)}}
@keyframes glow{from{transform:translateX(-50%) scale(.9)}to{transform:translateX(-50%) scale(1.05)}}

/* Typewriter look */
.typeLine{font-size:clamp(16px,3.6vw,22px); color:var(--muted); max-width:min(92vw,760px); margin:0 auto}

/* Balloons */
.balloon-area{position:relative;height:68vh;max-height:680px;width:100%;overflow:hidden;border-radius:18px;border:1px solid rgba(255,255,255,.08);background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.02));box-shadow:inset 0 1px 0 rgba(255,255,255,.04)}
.balloon{--c:#ff9ccc;--x:10;--delay:0;position:absolute;bottom:-120px;left:calc(var(--x)*1%);width:64px;height:80px;border-radius:50% 50% 45% 45%/55% 55% 45% 45%;background:radial-gradient(circle at 30% 30%,#fff8,transparent 60%),var(--c);box-shadow:inset -10px -16px 24px rgba(0,0,0,.2);animation:floatUp 16s linear infinite;animation-delay:calc(var(--delay)*1s);display:grid;place-items:center;color:#0c0e1a;font-weight:900;text-shadow:0 1px 0 #ffffff88;cursor:pointer}
.balloon::after{content:"";position:absolute;width:2px;height:120px;background:rgba(255,255,255,.3);left:50%;bottom:-120px}
.balloon span{background:#fff;padding:4px 8px;border-radius:999px;font-size:12px}
@keyframes floatUp{from{transform:translateY(0)}to{transform:translateY(-105vh)}}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:50}
.modal.show{display:flex}
.dialog{max-width:560px;margin:16px;background:linear-gradient(180deg,#0e1628,#0c1323);border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:18px;text-align:center;box-shadow:0 18px 40px rgba(0,0,0,.44)}
.dialog h4{margin:.25rem 0 .5rem;font-size:20px}
.dialog p{margin:0;color:#c8d2f0}

/* Spotlight gallery */
.gallery{width:min(1000px,95vw); margin:0 auto; display:grid; gap:14px}
.heroFrame{position:relative; border-radius:22px; overflow:hidden; height:min(62vh,560px); box-shadow:0 22px 60px rgba(0,0,0,.45); border:1px solid rgba(255,255,255,.12)}
.heroFrame img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover; transform:scale(1.06); animation:kenburns 14s ease-in-out infinite}
@keyframes kenburns{0%{transform:scale(1.06) translate(0,0)} 50%{transform:scale(1.12) translate(-2%, -2%)} 100%{transform:scale(1.06) translate(0,0)}}
.thumbs{display:grid; grid-template-columns:repeat(5,1fr); gap:10px}
.thumb{position:relative; border-radius:14px; overflow:hidden; height:80px; border:2px solid transparent; cursor:pointer}
.thumb img{width:100%; height:100%; object-fit:cover; transition:transform .2s}
.thumb:hover img{transform:scale(1.06)}
.thumb.active{border-color:var(--accent)}
.lb{display:none; position:fixed; inset:0; background:rgba(0,0,0,.85); z-index:90; align-items:center; justify-content:center}
.lb img{max-width:92vw; max-height:86vh; border-radius:14px; box-shadow:0 22px 60px rgba(0,0,0,.6); border:1px solid rgba(255,255,255,.15)}
.lb .pill{position:absolute; right:14px; top:14px}

/* Divine */
.temple-bg{position:absolute;inset:0;pointer-events:none;opacity:.25;background:radial-gradient(1200px 600px at 50% 10%,rgba(155,211,255,.08),transparent 60%)}
.card-3d{perspective:1200px;width:min(680px,92vw)}
.flip{position:relative;transform-style:preserve-3d;transition:transform .8s ease;cursor:pointer}
.flip .face{backface-visibility:hidden;border-radius:18px;padding:22px;border:1px solid rgba(255,255,255,.08);background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));box-shadow:0 18px 40px rgba(0,0,0,.2)}
.flip .back{position:absolute;inset:0;transform:rotateY(180deg)}
.flip.is-flipped{transform:rotateY(180deg)}
.front-title{font-weight:900;letter-spacing:.12em;color:var(--gold);text-transform:uppercase;font-size:12px}
.front-text{font-size:clamp(16px,3.4vw,20px);color:var(--muted)}

/* Final */
#fireCanvas{position:absolute;inset:0;pointer-events:none}
.final-inner{text-align:center;max-width:820px}
.glowtext{font-size:clamp(22px,5vw,38px);line-height:1.35;text-shadow:0 0 18px rgba(155,211,255,.25)}
.stack{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:10px}

/* Watermark, tips, theme cycling */
.watermark{position:fixed;right:12px;bottom:10px;z-index:15;font-size:12px;color:#bac3e0;opacity:.92;background:rgba(0,0,0,.2);padding:6px 10px;border-radius:12px;border:1px solid rgba(255,255,255,.08)}

/* print */
@media print{ .section, .stars, #petals, #constellation, .chapters, .themes, .watermark, #welcome, #ytOverlay { display:none !important } }
</style>
</head>
<body class="theme-girly">
  <!-- Theme chips -->
  <div class="themes">
    <button class="chip girly"  data-theme="girly"  title="Girly"></button>
    <button class="chip pink"   data-theme="pink"   title="Pink"></button>
    <button class="chip denim"  data-theme="denim"  title="Denim"></button>
    <button class="chip beige"  data-theme="beige"  title="Beige"></button>
    <button class="chip black"  data-theme="black"  title="Black"></button>
    <button class="chip auto"   data-theme="auto"   title="Auto"></button>
  </div>

  <!-- Nickname ribbon -->
  <div class="nick-ribbon">A page for <b>Shruti</b> ‚Äî lovingly called <b>Madamji</b>, <b>Laadliji</b>, and sometimes <b>Panditayan</b>.</div>

  <!-- Constellation + stars -->
  <canvas id="constellation" aria-hidden="true"></canvas>
  <div class="stars" aria-hidden="true"></div>

  <!-- Petals & hearts -->
  <div id="petals" aria-hidden="true"></div>
  <div id="hearts" aria-hidden="true"></div>

  <!-- Progress dots -->
  <nav class="chapters" aria-label="Story progress">
    <span class="dot active" data-target="#landing"></span>
    <span class="dot" data-target="#spark"></span>
    <span class="dot" data-target="#playful"></span>
    <span class="dot" data-target="#spotlight"></span>
    <span class="dot" data-target="#divine"></span>
    <span class="dot" data-target="#final"></span>
  </nav>

  <!-- YouTube overlay (optional) -->
  <div id="ytOverlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.7); z-index:80; align-items:center; justify-content:center;">
    <div style="width:min(860px,92vw); aspect-ratio:16/9; background:#000; border:1px solid rgba(255,255,255,.12); border-radius:12px; overflow:hidden; position:relative;">
      <iframe id="ytFrame" width="100%" height="100%" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
      <button id="ytClose" class="btn" style="position:absolute; right:10px; top:10px; border-radius:12px;">Close ‚úñ</button>
    </div>
  </div>

  <!-- Welcome -->
  <div class="welcome" id="welcome">
    <div class="card">
      <h2>Hi <span id="welcomeName">Shruti</span> üå∏</h2>
      <p>I made this tiny night just for you. Chal, Madamji‚Äîwalk with me and let the blessings unfold.</p>
      <div class="btn-row">
        <a class="btn" id="startJourney" href="#spark" onclick="window.__start && window.__start(); return false;">Start your tiny journey ‚ú®</a>
        <button class="btn" id="playSong" type="button">Play her song üéµ</button>
      </div>
      <p class="hint center" style="margin-top:8px">You can pre-load a track with <code>?yt=VIDEO_ID</code></p>
    </div>
  </div>

  <main>
    <!-- Landing -->
    <section class="section" id="landing">
      <div class="container landing-inner">
        <h1 class="title fade-up">On this special day, the universe plays its sweetest tune‚Ä¶ because it‚Äôs your day.</h1>
        <p class="hint">P.S. Laadliji, tap the button above if the music is shy üôÇ</p>
      </div>
    </section>

    <!-- Spark -->
    <section class="section" id="spark">
      <div class="container spark-wrap">
        <div class="diya" id="diya" aria-label="Glowing diya">
          <div class="bowl"></div><div class="oil"></div><div class="flame"></div><div class="glow"></div>
        </div>
        <p class="typeLine" id="typeLine">
          You keep mischief in my smile and peace in my steps. Panditayan, your steadiness is my favorite kind of magic.
        </p>
        <a href="#playful" class="btn">Next ‚Üí</a>
      </div>
    </section>

    <!-- Playful Blessings -->
    <section class="section" id="playful">
      <div class="container" style="width:min(100%,960px)">
        <h2 class="center" style="margin-bottom:14px; font-weight:900; letter-spacing:.06em; color:var(--accent); text-transform:uppercase; font-size:12px">Playful blessings</h2>
        <div class="balloon-area" id="balloonArea" aria-label="Blessing balloons"></div>
        <p class="hint center">Tap a balloon to pop it and reveal a tiny blessing, Madamji.</p>
        <a href="#spotlight" class="btn">Next ‚Üí</a>
      </div>
      <!-- Modal -->
      <div class="modal" id="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="dialog">
          <h4 id="modalTitle">A message</h4>
          <p id="modalMsg">You are loved.</p>
          <button class="btn" id="modalClose">Close</button>
        </div>
      </div>
    </section>

    <!-- Spotlight: ONLY her photos -->
    <section class="section" id="spotlight">
      <div class="container gallery">
        <div class="heroFrame">
          <img id="heroImg" alt="her" src="" />
        </div>
        <div class="thumbs" id="thumbs"></div>
        <p class="hint center">Every picture whispers the same thing: ‚Äúyou‚Äôre trouble‚Ä¶ the good kind.‚Äù</p>
        <a href="#divine" class="btn center" style="justify-self:center">Next ‚Üí</a>
      </div>
    </section>

    <!-- Divine -->
    <section class="section" id="divine">
      <div class="temple-bg" aria-hidden="true"></div>
      <div class="container" style="display:grid; place-items:center">
        <div class="card-3d">
          <div class="flip" id="flipCard" aria-label="Digital birthday card. Tap to flip.">
            <div class="face front">
              <div class="front-title">Divine Blessings</div>
              <div class="front-text" style="margin-top:6px">Tap to open your card</div>
              <svg width="100%" height="120" viewBox="0 0 600 120" aria-hidden="true" style="opacity:.35; margin-top:8px">
                <path d="M50,110 L120,110 L140,80 L160,110 L300,110 L320,70 L340,110 L460,110 L480,85 L500,110 L560,110" fill="none" stroke="url(#g)" stroke-width="2"/>
                <defs><linearGradient id="g" x1="0" x2="1"><stop offset="0%" stop-color="#9bd3ff"/><stop offset="100%" stop-color="#c9a7ff"/></linearGradient></defs>
              </svg>
            </div>
            <div class="face back">
              <div style="font-size:clamp(16px, 3.5vw, 20px); line-height:1.7">
                May Kanha and <strong>Bajrangbali</strong> keep you safe. And may your days be soft where you need softness and strong where you need strength, Madamji.
              </div>
              <div style="margin-top:12px; color:var(--muted)">Tap again to close</div>
            </div>
          </div>
        </div>
        <a href="#final" class="btn" style="margin-top:14px">Next ‚Üí</a>
      </div>
    </section>

    <!-- Final -->
    <section class="section" id="final" style="overflow:hidden">
      <canvas id="fireCanvas" aria-hidden="true"></canvas>
      <div class="container final-inner">
        <div class="glowtext" id="finalText">
          Happy Birthday, <span id="herNameDynamic">Shruti</span>.<br/>
          You aren‚Äôt just a day in my life ‚Äî you‚Äôre why my days feel alive. Laadliji, thank you for being you.
        </div>
        <div class="stack">
          <button class="btn" id="giftBtn">Open cute surprise üéÅ</button>
          <button class="btn" id="playSongFinal">Play her song again üéµ</button>
        </div>
      </div>
    </section>
  </main>

  <div class="watermark">Exclusively for <span id="wmName">Shruti</span> ‚Ä¢ Madamji ‚Ä¢ Laadliji ‚Ä¢ Panditayan</div>

<script>
/* ============== PERSONAL DEFAULTS ============== */
const DEFAULTS = { name:'Shruti', from:'Pandit Ji', theme:'girly' };

/* ============== HELPERS ============== */
const $ = (s,root=document)=>root.querySelector(s);
const $$ = (s,root=document)=>Array.from(root.querySelectorAll(s));

/* ============== PETALS + HEARTS FLOAT ============== */
(function petals(){
  const wrap = $('#petals'), hearts = $('#hearts');
  for(let i=0;i<26;i++){
    const p = document.createElement('div'); p.className='petal';
    p.style.left = (Math.random()*100) + 'vw';
    const sz = 10 + Math.random()*12; p.style.width=sz+'px'; p.style.height=sz+'px';
    const dur = 9000 + Math.random()*7000, delay = Math.random()*4000;
    const horiz = (Math.random()<.5?-1:1) * (10 + Math.random()*14);
    p.animate([{transform:`translate(0,0) rotate(0deg)`,top:'-40px'},
               {transform:`translate(${horiz}vw,110vh) rotate(${Math.random()*360}deg)`,top:'110vh'}],
               {duration:dur,delay,iterations:Infinity,easing:'ease-in'});
    wrap.appendChild(p);
  }
  for(let i=0;i<12;i++){
    const h = document.createElement('div'); h.className='heartFloat'; h.textContent='‚ù§Ô∏è';
    h.style.left = (Math.random()*100) + 'vw';
    const dur = 8000 + Math.random()*6000, delay = Math.random()*4000, drift = (Math.random()*2-1)*20;
    h.animate([{transform:`translate(0,0)`},{transform:`translate(${drift}vw,100vh)`}],{duration:dur,delay,iterations:Infinity,easing:'ease-in'});
    hearts.appendChild(h);
  }
})();

/* ============== WEB AUDIO (soft flute/bell) ============== */
let audioCtx, masterGain;
function makeAmbience(){
  if(audioCtx) return;
  audioCtx = new (window.AudioContext||window.webkitAudioContext)();
  masterGain = audioCtx.createGain(); masterGain.gain.value=0.0; masterGain.connect(audioCtx.destination);

  function flute(freq,start,dur,g=0.14){
    const o=audioCtx.createOscillator(); o.type='sine'; o.frequency.value=freq;
    const gnode=audioCtx.createGain(); gnode.gain.value=0.0001;
    const vib=audioCtx.createOscillator(); vib.type='sine'; vib.frequency.value=5;
    const vg=audioCtx.createGain(); vg.gain.value=2; vib.connect(vg); vg.connect(o.frequency);
    o.connect(gnode); gnode.connect(masterGain);
    gnode.gain.setValueAtTime(0.0001,start);
    gnode.gain.linearRampToValueAtTime(g,start+0.4);
    gnode.gain.linearRampToValueAtTime(g*0.42,start+0.8);
    gnode.gain.exponentialRampToValueAtTime(0.0001,start+dur);
    o.start(start); vib.start(start); o.stop(start+dur+0.05); vib.stop(start+dur+0.05);
  }
  function bell(t){
    [1,2.01,2.98,4.2].forEach((m,i)=>{
      const o=audioCtx.createOscillator(); o.type='sine'; o.frequency.value=660*m;
      const g=audioCtx.createGain(); g.gain.value=0.0001; o.connect(g); g.connect(masterGain);
      g.gain.setValueAtTime(0.0001,t);
      g.gain.exponentialRampToValueAtTime(0.08/(i+1),t+0.02);
      g.gain.exponentialRampToValueAtTime(0.0001,t+1.2+i*0.2);
      o.start(t); o.stop(t+1.6+i*0.2);
    });
  }
  function phrase(t0){ [440,494,523,587,523,494,440].forEach((f,i)=>flute(f/2,t0+i*0.9,1.2)); bell(t0+2.7) }
  const start=(audioCtx.currentTime||0)+0.1; phrase(start);
  setInterval(()=>phrase(audioCtx.currentTime+0.1),5000);

  const fade=()=>{ audioCtx.resume&&audioCtx.resume(); masterGain.gain.cancelScheduledValues(audioCtx.currentTime); masterGain.gain.linearRampToValueAtTime(0.10,audioCtx.currentTime+1.0); };
  $('#startJourney')?.addEventListener('click',fade,{once:true});
}

/* ============== YOUTUBE OVERLAY ============== */
function openYT(){
  const id=new URLSearchParams(location.search).get('yt');
  if(!id){ alert('Add ?yt=VIDEO_ID in the URL to load a song.'); return; }
  const ov=$('#ytOverlay'), fr=$('#ytFrame');
  fr.src=`https://www.youtube.com/embed/${id}?autoplay=1&rel=0&modestbranding=1&playsinline=1&loop=1&playlist=${id}`;
  ov.style.display='flex';
}
$('#playSong').addEventListener('click',openYT);
$('#playSongFinal').addEventListener('click',openYT);
$('#ytClose').addEventListener('click',()=>{ $('#ytOverlay').style.display='none'; $('#ytFrame').src=''; });

/* ============== CONSTELLATION: FULL NAME ============== */
(function constellation(){
  const cvs = document.getElementById('constellation'); const ctx = cvs.getContext('2d');
  function fit(){ cvs.width = innerWidth; cvs.height = innerHeight; }
  fit(); addEventListener('resize', fit);
  let pts = [];
  function ensureParticles(n){ if(pts.length<n){ for(let i=pts.length;i<n;i++) pts.push({x:Math.random()*cvs.width, y:Math.random()*cvs.height*0.8+cvs.height*0.1, tx:0, ty:0}); } else if(pts.length>n){ pts=pts.slice(0,n); } }
  function lines(name){ const t=(name||'You').trim().replace(/\s+/g,' '); if(t.length<=14) return [t]; const mid=Math.floor(t.length/2); let s=t.lastIndexOf(' ',mid); if(s<6||t.length-s<6) s=t.indexOf(' ',mid); return s>0?[t.slice(0,s),t.slice(s+1)]:[t]; }
  function targets(lines,density=22){
    const off=document.createElement('canvas'), o=off.getContext('2d'); off.width=cvs.width; off.height=cvs.height;
    const fam='Poppins, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    const maxW=off.width*0.84; let fs=Math.min(200,Math.max(70,off.width*0.16));
    function w(t){ o.font=`800 ${fs}px ${fam}`; return o.measureText(t).width; }
    while(Math.max(...lines.map(w))>maxW && fs>36) fs-=2;
    const midY=off.height*0.42, gap=fs*1.2; o.textAlign='center'; o.textBaseline='middle'; o.fillStyle='#fff'; o.font=`800 ${fs}px ${fam}`;
    lines.forEach((t,i)=>o.fillText(t,off.width/2,midY+(i-(lines.length-1)/2)*gap));
    const data=o.getImageData(0,0,off.width,off.height).data, arr=[], step=Math.max(1,Math.floor(fs/density));
    for(let y=0;y<off.height;y+=step) for(let x=0;x<off.width;x+=step) if(data[(y*off.width+x)*4+3]>128) arr.push({x,y});
    return arr;
  }
  function moveTo(name,hold=4000){
    const ls=lines(name), cloud=targets(ls);
    const N=Math.min(560,Math.max(220,Math.floor(cloud.length*0.55)));
    ensureParticles(N);
    const sel=[]; for(let i=0;i<N;i++) sel.push(cloud[Math.floor(i*(cloud.length/N))]||{x:Math.random()*cvs.width,y:Math.random()*cvs.height});
    pts.forEach((p,i)=>{ p.tx=sel[i].x; p.ty=sel[i].y; });
    let phase='in', t0=performance.now();
    function frame(t){
      ctx.clearRect(0,0,cvs.width,cvs.height);
      for(const p of pts){ p.x+=(p.tx-p.x)*0.08; p.y+=(p.ty-p.y)*0.08; ctx.fillStyle='rgba(255,210,230,0.95)'; ctx.fillRect(p.x,p.y,2,2); }
      if(phase==='in' && t-t0>hold){ phase='out'; pts.forEach(p=>{ p.tx=Math.random()*cvs.width; p.ty=Math.random()*cvs.height*0.8+cvs.height*0.1; }); }
      if(phase==='out'){ const moving=pts.some(p=>Math.hypot(p.tx-p.x,p.ty-p.y)>0.6); if(!moving) return; }
      requestAnimationFrame(frame);
    }
    requestAnimationFrame(frame);
  }
  function start(){ const nm=$('#herNameDynamic')?.textContent || DEFAULTS.name; moveTo(nm); }
  document.getElementById('startJourney')?.addEventListener('click', start, { once:true });
})();

/* ============== CHAPTER PROGRESS + SECTION TRIGGERS ============== */
(function chapters(){
  const ids=['landing','spark','playful','spotlight','divine','final'], dots=$$('.dot');
  dots.forEach(d=>d.addEventListener('click',()=>{ const t=d.getAttribute('data-target'); if(t) location.hash=t; }));
  const io=new IntersectionObserver((es)=>{ es.forEach(e=>{ if(e.isIntersecting){ const i=ids.indexOf(e.target.id); dots.forEach((d,idx)=>d.classList.toggle('active',idx===i)); if(e.target.id==='spark') lightDiya(); if(e.target.id==='playful') spawnBalloons(); if(e.target.id==='final') fireworks(); } });},{threshold:.5});
  ids.forEach(id=>io.observe($('#'+id)));
})();

/* ============== TYPELINE (fake typewriter) ============== */
function runType(){ const el=$('#typeLine'); const text=el.textContent.trim(); el.textContent=''; let i=0; const t=setInterval(()=>{ el.textContent+=text.charAt(i++); if(i>=text.length) clearInterval(t); },26); }
function lightDiya(){ $('#diya').classList.add('lit'); runType(); }

/* ============== BALLOONS + MODAL ============== */
const blessings = [
  {word:'Joy',color:'#ff9ccc', msg:'For days you forget how bright you are: may ordinary moments turn into little festivals around you, Madamji.'},
  {word:'Strength',color:'#9bd3ff', msg:'When the world feels heavy, remember‚Äîyou never have to carry it alone. I‚Äôll be the steady shoulder.'},
  {word:'Faith',color:'#c9a7ff', msg:'May your prayers meet their perfect timing; until then, may trust make the waiting light.'},
  {word:'Love',color:'#7ee6c9', msg:'You are loved in a quiet, consistent way‚Äîno drama, just warmth that keeps showing up, Laadliji.'},
];
let balloonsMade=false;
function spawnBalloons(){
  if(balloonsMade) return; balloonsMade=true;
  const area=$('#balloonArea');
  blessings.forEach((b,i)=>{
    const d=document.createElement('button'); d.className='balloon';
    d.style.setProperty('--c',b.color); d.style.setProperty('--x',10+i*20+(Math.random()*10)); d.style.setProperty('--delay',Math.random()*6);
    d.innerHTML=`<span>${b.word}</span>`;
    d.addEventListener('click',()=>{ d.animate([{transform:'scale(1)'},{transform:'scale(1.2)'},{transform:'scale(0)'}],{duration:260,easing:'ease-in'}); setTimeout(()=>d.remove(),240); showModal(b.word,b.msg); });
    area.appendChild(d);
  });
}
function showModal(title,msg){ $('#modalTitle').textContent=title; $('#modalMsg').textContent=msg; $('#modal').classList.add('show'); }
$('#modal').addEventListener('click',(e)=>{ if(e.target.id==='modal'||e.target.id==='modalClose') $('#modal').classList.remove('show'); });

/* ============== SPOTLIGHT GALLERY (ONLY HER PHOTOS) ============== */
const PHOTO_LIST = [
  // Put Shruti's photos here (host in /images on GitHub or absolute URLs):
  // {src:'images/shruti1.jpg'}, {src:'images/shruti2.jpg'}, {src:'images/shruti3.jpg'},
];
function setupGallery(){
  const hero=$('#heroImg'), root=$('#thumbs');
  if(!hero || !root) return;
  if(PHOTO_LIST.length===0){ hero.src='https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=1600&q=80&auto=format&fit=crop'; root.innerHTML='<div class="hint" style="grid-column:1/-1;text-align:center">Add her photos in <code>PHOTO_LIST</code> to make this truly hers.</div>'; return; }
  let cur=0; hero.src=PHOTO_LIST[0].src;
  PHOTO_LIST.forEach((p,i)=>{
    const t=document.createElement('div'); t.className='thumb'+(i===0?' active':''); t.innerHTML=`<img src="${p.src}" alt="her ${i+1}">`;
    t.addEventListener('click',()=>{ cur=i; hero.src=p.src; $$('.thumb').forEach(x=>x.classList.remove('active')); t.classList.add('active'); });
    t.addEventListener('dblclick',()=> openLightbox(i));
    root.appendChild(t);
  });
  hero.addEventListener('click',()=> openLightbox(cur));
}
function openLightbox(i){
  const lb=document.createElement('div'); lb.className='lb'; lb.innerHTML=`<img src="${PHOTO_LIST[i]?.src||$('#heroImg').src}" alt="her"><button class="btn pill">Close ‚úñ</button>`;
  document.body.appendChild(lb); lb.style.display='flex';
  lb.querySelector('.pill').onclick=()=>lb.remove();
  lb.onclick=(e)=>{ if(e.target===lb) lb.remove(); };
}

/* ============== DIVINE CARD ============== */
$('#flipCard').addEventListener('click',()=> $('#flipCard').classList.toggle('is-flipped'));

/* ============== HEART FIREWORKS ============== */
let fw=false;
function fireworks(){
  if(fw) return; fw=true;
  const c=document.getElementById('fireCanvas'), ctx=c.getContext('2d');
  function fit(){ c.width=innerWidth; c.height=Math.max(300,innerHeight*0.9) } fit(); addEventListener('resize',fit);
  const parts=[];
  function add(x,y,vx,vy,color){ parts.push({x,y,vx,vy,life:70+Math.random()*30,color}); }
  function heartVec(t){ const x=16*Math.sin(t)**3; const y=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t); return {x, y:-y}; }
  function burstCircle(x,y,color){ const n=90; for(let i=0;i<n;i++){ const a=(Math.PI*2)*i/n, sp=2+Math.random()*3; add(x,y,Math.cos(a)*sp,Math.sin(a)*sp,color);} }
  function burstHeart(x,y,color){ const n=140; for(let i=0;i<n;i++){ const t=(i/n)*Math.PI*2; const v=heartVec(t), mag=Math.hypot(v.x,v.y)||1; const sp=2.2+Math.random()*2.4; add(x,y,(v.x/mag)*sp,(v.y/mag)*sp,color);} }
  function tick(){ ctx.clearRect(0,0,c.width,c.height); for(let i=parts.length-1;i>=0;i--){ const p=parts[i]; p.x+=p.vx; p.y+=p.vy; p.vy+=0.03; p.life--; ctx.fillStyle=`rgba(${p.color},${Math.max(0,p.life/100)})`; ctx.fillRect(p.x,p.y,2,2); if(p.life<=0) parts.splice(i,1);} requestAnimationFrame(tick); }
  tick();
  function boom(){ const x=Math.random()*c.width*0.9+c.width*0.05; const y=Math.random()*c.height*0.4+c.height*0.1; const colors=['255,200,221','255,168,194','201,167,255','246,208,110']; (Math.random()<0.65?burstHeart:burstCircle)(x,y,colors[Math.floor(Math.random()*colors.length)]); }
  for(let i=0;i<4;i++) setTimeout(boom,i*400); const iv=setInterval(boom,1200); setTimeout(()=>clearInterval(iv),12000);
}

/* ============== STICKER RAIN (gift) ============== */
function stickerRain(arr=['üß∏','üç´','üíó','üíû','‚ú®','üå∏','üç¨','ü™î']){
  const D=5200, start=performance.now();
  (function spawn(){
    if(performance.now()-start>D) return;
    const s=document.createElement('span'); s.style.position='fixed'; s.style.top='-40px'; s.style.fontSize='32px'; s.style.zIndex='60'; s.textContent=arr[Math.floor(Math.random()*arr.length)];
    s.style.left=(Math.random()*innerWidth)+'px'; document.body.appendChild(s);
    const drift=(Math.random()*2-1)*80, time=2400+Math.random()*1800;
    s.animate([{transform:'translate(0,-40px)',opacity:.95},{transform:`translate(${drift}px, ${innerHeight+60}px)`,opacity:0.1}],{duration:time,easing:'ease-in'});
    setTimeout(()=>s.remove(),time+50); requestAnimationFrame(spawn);
  })();
}
$('#giftBtn').addEventListener('click',()=>stickerRain());

/* ============== THEMES & AUTO-CYCLE ============== */
let autoCycle=null, cycleIdx=0, cycleList=['girly','pink','denim','beige','black'];
function setTheme(t){
  document.body.classList.remove('theme-girly','theme-pink','theme-denim','theme-beige','theme-black');
  if(t==='auto'){ if(autoCycle) clearInterval(autoCycle); document.body.classList.add('theme-'+cycleList[cycleIdx%cycleList.length]); autoCycle=setInterval(()=>{ cycleIdx++; document.body.classList.remove('theme-girly','theme-pink','theme-denim','theme-beige','theme-black'); document.body.classList.add('theme-'+cycleList[cycleIdx%cycleList.length]); }, 6000); return; }
  if(autoCycle) { clearInterval(autoCycle); autoCycle=null; }
  document.body.classList.add('theme-'+t);
}
$$('.chip').forEach(c=>c.addEventListener('click',()=>setTheme(c.dataset.theme)));

/* ============== PARAMS & INIT ============== */
(function params(){
  const q=new URLSearchParams(location.search);
  const name=q.get('name')||DEFAULTS.name, from=q.get('from')||DEFAULTS.from, theme=(q.get('theme')||DEFAULTS.theme).toLowerCase();
  $('#herNameDynamic').textContent=name||'you'; $('#welcomeName').textContent=name||'you'; $('#wmName').textContent=name||'you';
  setTheme(theme);
  // if Teacher's Day birthday (Sep 5), give a subtle extra glow
  const d=new Date(); if(d.getMonth()===8 && d.getDate()===5) document.body.classList.add('her-day');
})();

/* ============== ROBUST START (works everywhere) ============== */
window.__start = function () {
  try {
    var w = document.getElementById('welcome');
    if (w) { w.classList.add('fade-out'); setTimeout(function(){ w.remove(); }, 300); }
    try { makeAmbience(); } catch {}
    if (location.hash !== '#spark') location.hash = '#spark';
  } catch (e) {}
};
// bypass with ?skip=1
if (new URLSearchParams(location.search).get('skip') === '1') window.__start();

/* ============== BUILD GALLERY ============== */
setupGallery();
</script>
</body>
</html>